// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// ğŸ´ ğ›«ğ‘ˆğ‘…ğ›©ğ›®ğ›¥ â€” ğ‘¿ğ›­ğ‘« ğŸ´
// WhatsApp Connection Update Handler
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

const { DisconnectReason } = require('bailey');

function handleConnectionUpdate(update, reconnect) {
    const { connection, lastDisconnect, pairingCode } = update;

    // Raison potentielle de dÃ©connexion
    const statusCode = lastDisconnect?.error?.output?.statusCode;

    switch (connection) {
        case 'close':
            // VÃ©rifier si une reconnexion est nÃ©cessaire
            if (statusCode !== DisconnectReason.loggedOut) {
                console.log(`ğŸ”Œ DÃ©connexion dÃ©tectÃ©e | Code: ${statusCode || 'inconnu'}`);
                console.log('ğŸ”„ Reconnexion en cours...');
                reconnect();
            } else {
                console.log('âŒ DÃ©connexion permanente | Session terminÃ©e, rÃ©authentification requise.');
            }
            break;

        case 'open':
            console.log('âœ… Connexion Ã©tablie | ğŸ´ ğ›«ğ‘ˆğ‘…ğ›©ğ›®ğ›¥ â€” ğ‘¿ğ›­ğ‘« ğŸ´');
            break;

        default:
            // Gestion du pairing code si disponible
            if (pairingCode) {
                console.log(`ğŸ“² Pairing Code gÃ©nÃ©rÃ© : ${pairingCode}`);
            }
            break;
    }
}

module.exports = handleConnectionUpdate;
